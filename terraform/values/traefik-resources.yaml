ingressRoutes:
  homepage:
    namespace: homelab
    match: Host("home.kieranajp.uk")
    middlewares:
    - google-auth
    service:
      name: homepage
      port: 10352

  homeassistant:
    namespace: homelab
    match: Host("homeassistant.kieranajp.uk")
    #middlewares:
    #- google-auth
    service:
      name: home-assistant
      port: 8080

  # Example API route using OAuth authentication for MCP
  api-example:
    namespace: homelab
    match: Host("api.kieranajp.uk")
    middlewares:
    - oauth-auth
    service:
      name: api-service
      port: 8080

middlewares:
  google-auth:
    namespace: homelab
    spec: |
      plugin:
        google-oidc-auth-middleware:
          oidc:
            clientID: "${google_client_id}"
            clientSecret: "${google_client_secret}"
          cookie:
            secret: "${cookie_secret}"
          authorized:
            domains:
            - kieranajp.co.uk

  oauth-auth:
    namespace: homelab
    spec: |
      forwardAuth:
        address: "http://oathkeeper-proxy.auth.svc.cluster.local:4455"
        authResponseHeaders:
        - "X-User"
