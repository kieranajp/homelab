apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-scripts
  namespace: {{ .Release.Namespace }}
data:
  copy-to-calibre.sh: |
    #!/bin/bash
    # LazyLibrarian custom script to copy books to Calibre-Web-Automated ingest folder
    # Usage: Called by LazyLibrarian with book path as first argument

    BOOK_FILE="$1"
    INGEST_DIR="/cwa-ingest"

    if [ -z "$BOOK_FILE" ]; then
      echo "Error: No file path provided"
      exit 1
    fi

    if [ ! -f "$BOOK_FILE" ]; then
      echo "Error: File not found: $BOOK_FILE"
      exit 1
    fi

    if [ ! -d "$INGEST_DIR" ]; then
      echo "Error: Ingest directory not found: $INGEST_DIR"
      exit 1
    fi

    # Copy the file to the ingest directory
    echo "Copying $BOOK_FILE to $INGEST_DIR"
    cp "$BOOK_FILE" "$INGEST_DIR/"

    if [ $? -eq 0 ]; then
      echo "Successfully copied to Calibre-Web-Automated ingest folder"
      exit 0
    else
      echo "Error: Failed to copy file"
      exit 1
    fi
