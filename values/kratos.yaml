kratos:
  config:
    dsn: postgres://postgres:${postgres_password}@auth-postgresql:5432/kratos?sslmode=disable

    dev: true

    serve:
      public:
        base_url: https://kratos.kieranajp.uk
        cors:
          enabled: true
          allowed_origins:
            - https://kratos.kieranajp.uk
            - https://home.kieranajp.uk
      admin:
        base_url: http://kratos-admin:4434

    cookies:
      domain: kieranajp.uk
      path: /
      same_site: Lax

    selfservice:
      default_browser_return_url: https://home.kieranajp.uk
      allowed_return_urls:
        - https://*.kieranajp.uk
      methods:
        password:
          enabled: false
        oidc:
          enabled: true
          config:
            providers:
              - id: google
                provider: google
                client_id: ${google_client_id}
                client_secret: ${google_client_secret}
                mapper_url: base64://${oidc_mapper}
                scope:
                  - openid
                  - email
                  - profile
                requested_claims:
                  id_token:
                    email:
                      essential: true
                    email_verified:
                      essential: true

      flows:
        login:
          ui_url: https://kratos.kieranajp.uk/ui/login
          after:
            default_browser_return_url: https://home.kieranajp.uk
        registration:
          enabled: true
          ui_url: https://kratos.kieranajp.uk/ui/registration
          after:
            default_browser_return_url: https://home.kieranajp.uk
        logout:
          after:
            default_browser_return_url: https://home.kieranajp.uk
        settings:
          ui_url: https://kratos.kieranajp.uk/ui/settings

    secrets:
      cookie:
        - ${kratos_secret}
      cipher:
        - ${kratos_secret}

    identity:
      default_schema_id: default
      schemas:
        - id: default
          url: base64://${identity_schema}

deployment:
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

service:
  admin:
    enabled: true
    type: ClusterIP
    port: 4434
  public:
    enabled: true
    type: ClusterIP
    port: 4433

ingress:
  admin:
    enabled: false
  public:
    enabled: false

job:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-weight: "1"
    helm.sh/hook-delete-policy: before-hook-creation
