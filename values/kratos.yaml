kratos:
  config:
    dsn: postgres://postgres:${postgres_password}@auth-postgresql:5432/kratos?sslmode=disable

    dev: true

    serve:
      public:
        base_url: https://kratos.kieranajp.uk
        cors:
          enabled: true
          allowed_origins:
            - https://kratos.kieranajp.uk
            - https://home.kieranajp.uk
      admin:
        base_url: http://kratos-admin:4434

    cookies:
      domain: kieranajp.uk
      path: /
      same_site: Lax

    selfservice:
      default_browser_return_url: https://home.kieranajp.uk
      allowed_return_urls:
        - https://home.kieranajp.uk
        - https://homeassistant.kieranajp.uk
        - https://grafana.kieranajp.uk

      methods:
        oidc:
          enabled: true
          config:
            providers:
              - id: google
                provider: google
                client_id: ${google_client_id}
                client_secret: ${google_client_secret}
                mapper_url: base64://ewogICJpZGVudGl0eSI6IHsKICAgICJ0cmFpdHMiOiB7CiAgICAgICJlbWFpbCI6ICJhc3NlcnRpb24uZW1haWwiLAogICAgICAibmFtZSI6IHsKICAgICAgICAiZmlyc3QiOiAiYXNzZXJ0aW9uLmdpdmVuX25hbWUiLAogICAgICAgICJsYXN0IjogImFzc2VydGlvbi5mYW1pbHlfbmFtZSIKICAgICAgfQogICAgfQogIH0KfQ==
                scope:
                  - openid
                  - email
                  - profile
                requested_claims:
                  id_token:
                    email:
                      essential: true
                    email_verified:
                      essential: true

      flows:
        login:
          ui_url: https://kratos.kieranajp.uk/ui/login
          after:
            default_browser_return_url: https://home.kieranajp.uk
        registration:
          enabled: true
          ui_url: https://kratos.kieranajp.uk/ui/registration
          after:
            default_browser_return_url: https://home.kieranajp.uk
        logout:
          after:
            default_browser_return_url: https://home.kieranajp.uk
        settings:
          ui_url: https://kratos.kieranajp.uk/ui/settings

    secrets:
      cookie:
        - ${kratos_secret}
      cipher:
        - ${kratos_secret}

    identity:
      default_schema_id: default
      schemas:
        - id: default
          url: base64://ewogICIkaWQiOiAiaHR0cHM6Ly9zY2hlbWFzLm9yeS5zaC9wcmVzZXRzL2tyYXRvcy9pZGVudGl0eS5lbWFpbC5zY2hlbWEuanNvbiIsCiAgIiRzY2hlbWEiOiAiaHR0cDovL2pzb24tc2NoZW1hLm9yZy9kcmFmdC0wNy9zY2hlbWEjIiwKICAidGl0bGUiOiAiUGVyc29uIiwKICAidHlwZSI6ICJvYmplY3QiLAogICJwcm9wZXJ0aWVzIjogewogICAgInRyYWl0cyI6IHsKICAgICAgInR5cGUiOiAib2JqZWN0IiwKICAgICAgInByb3BlcnRpZXMiOiB7CiAgICAgICAgImVtYWlsIjogewogICAgICAgICAgInR5cGUiOiAic3RyaW5nIiwKICAgICAgICAgICJmb3JtYXQiOiAiZW1haWwiLAogICAgICAgICAgInBhdHRlcm4iOiAiQGtpZXJhbmFqcFxcLmNvXFwudWskIiwKICAgICAgICAgICJ0aXRsZSI6ICJFLU1haWwiLAogICAgICAgICAgIm9yeS5zaC9rcmF0b3MiOiB7CiAgICAgICAgICAgICJjcmVkZW50aWFscyI6IHsKICAgICAgICAgICAgICAicGFzc3dvcmQiOiB7CiAgICAgICAgICAgICAgICAiaWRlbnRpZmllciI6IHRydWUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgICJuYW1lIjogewogICAgICAgICAgInR5cGUiOiAib2JqZWN0IiwKICAgICAgICAgICJwcm9wZXJ0aWVzIjogewogICAgICAgICAgICAiZmlyc3QiOiB7CiAgICAgICAgICAgICAgInR5cGUiOiAic3RyaW5nIgogICAgICAgICAgICB9LAogICAgICAgICAgICAibGFzdCI6IHsKICAgICAgICAgICAgICAidHlwZSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgICJyZXF1aXJlZCI6IFsKICAgICAgICAiZW1haWwiCiAgICAgIF0sCiAgICAgICJhZGRpdGlvbmFsUHJvcGVydGllcyI6IGZhbHNlCiAgICB9CiAgfQp9Cg==

deployment:
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

service:
  admin:
    enabled: true
    type: ClusterIP
    port: 4434
  public:
    enabled: true
    type: ClusterIP
    port: 4433

ingress:
  admin:
    enabled: false
  public:
    enabled: false

job:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-weight: "1"
    helm.sh/hook-delete-policy: before-hook-creation
