controller:
  type: Deployment

deploymentStrategy: Recreate

ingress:
  external: true

configuration:
  enabled: true
  trusted_proxies:
    - "10.0.0.0/8"

additionalPorts:
  - name: sonos
    containerPort: 1400
    hostPort: 1400
    protocol: TCP

persistence:
  enabled: true
  size: 5Gi

initContainers:
  - name: install-custom-components
    image: alpine:latest
    env:
      - name: ZIPS
        value: |
          hacs=https://github.com/hacs/integration/releases/latest/download/hacs.zip
    command:
      - /bin/sh
      - -c
      - |
        mkdir -p /config/custom_components
        echo "$ZIPS" | while read -r entry; do
          [ -z "$entry" ] && continue
          name="${entry%%=*}"
          url="${entry#*=}"
          wget -O "/tmp/$name.zip" "$url"
          unzip -o "/tmp/$name.zip" -d "/config/custom_components/$name"
        done
    volumeMounts:
      - name: home-assistant-pvc
        mountPath: /config
